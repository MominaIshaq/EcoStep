<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EcoStep â€¢ Eco Quiz</title>
  <meta name="description" content="Test your eco knowledge and earn badges.">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body data-page="ecoquiz">
  <canvas id="particlesCanvas" aria-hidden="true"></canvas>
  <div id="pageTransition" aria-hidden="true"></div>
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo"><i class="fas fa-leaf"></i><span>EcoStep</span></div>
      <ul class="nav-menu">
        <li><a class="nav-link" href="index.html">Home</a></li>
        <li><a class="nav-link" href="quiz.html">Quiz</a></li>
        <li><a class="nav-link" href="ecoquiz.html">Eco Quiz</a></li>
        <li><a class="nav-link" href="dashboard.html">Dashboard</a></li>
        <li><a class="nav-link" href="hub.html">Hub</a></li>
      </ul>
      <div class="nav-actions"><div id="authControls"></div></div>
    </div>
  </nav>

  <main class="container" style="padding-top:100px;padding-bottom:60px">
    <h1 class="section-title"><i class="fas fa-circle-question"></i> Eco Quiz</h1>
    <p class="section-subtitle">Multiple-choice questions about climate and habits.</p>
    <div class="viz-card" id="quizBox">
      <div id="eqQuestion">Loading...</div>
      <div id="eqChoices" style="margin-top:.5rem"></div>
      <div style="margin-top:.75rem;display:flex;gap:.5rem">
        <button class="nav-btn" id="eqNext"><i class="fas fa-forward"></i> Next</button>
      </div>
      <div id="eqProgress" class="tip-description" style="margin-top:.5rem"></div>
    </div>
    <div class="viz-card" id="eqResult" style="display:none;margin-top:1rem">
      <h3 class="future-title">Your Score</h3>
      <p id="eqScore"></p>
      <p id="eqBadge"></p>
    </div>
  </main>

  <footer class="footer"><div class="container"><div class="footer-bottom"><p>&copy; 2024 EcoStep</p></div></div></footer>

  <script src="auth.js"></script>
  <script>
    const PATH = 'data/ecoquiz.json';
    let q = []; let i = 0; let score = 0;
    async function load(){ try { const res = await fetch(PATH); q = await res.json(); show(); } catch { document.getElementById('eqQuestion').textContent='Failed to load quiz.'; } }
    function show(){ if (i>=q.length) return done(); const cur = q[i]; const box = document.getElementById('eqChoices'); document.getElementById('eqQuestion').textContent = cur.question; box.innerHTML = cur.choices.map((c,idx)=> `<label class="option"><input type="radio" name="c" value="${idx}"/><span class="option-text">${c}</span></label>`).join(''); document.getElementById('eqProgress').textContent = `Question ${i+1} of ${q.length}`; }
    function next(){ const sel = document.querySelector('input[name="c"]:checked'); if (!sel) return; if (Number(sel.value) === q[i].answer) score++; i++; show(); }
    function done(){ document.getElementById('quizBox').style.display='none'; const pct = Math.round((score/q.length)*100); const badge = pct>=80 ? 'Eco Pro' : (pct>=50 ? 'Eco Learner' : 'Eco Beginner'); document.getElementById('eqScore').textContent = `Score: ${score}/${q.length} (${pct}%)`; document.getElementById('eqBadge').textContent = `Badge earned: ${badge}`; document.getElementById('eqResult').style.display='block'; try { const key='ecoquiz_scores'; const arr = JSON.parse(localStorage.getItem(key)||'[]'); arr.push({ ts: Date.now(), score, total: q.length, badge }); localStorage.setItem(key, JSON.stringify(arr)); } catch {}
      try { if (window.EcoAuth){ const u = EcoAuth.getCurrentUser(); if (u && !u.badges.includes(badge)){ const users = JSON.parse(localStorage.getItem('eco_users')||'[]'); const idx = users.findIndex(x=> x.email===u.email); if (idx>-1){ users[idx].badges.push(badge); localStorage.setItem('eco_users', JSON.stringify(users)); } } } } catch {}
    }
    document.getElementById('eqNext').addEventListener('click', next);
    load();
  </script>
  <script src="script.js"></script>
</body>
</html>
